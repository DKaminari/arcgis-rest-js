<h1>Webmaps</h1>

<ul class="list-reset">
  {#each webmaps as webmap}
  <li class="py-2">
    <a href="webmaps/{webmap.id}" class="text-blue">{webmap.title}</a>
  </li>
  {/each}
</ul>

<script>
  import { UserSession } from "@esri/arcgis-rest-auth";
  import { searchItems } from "@esri/arcgis-rest-items";
  import { retryWithNewSession } from "../../utils.js";

  export default {
    preload() {
      const { session } = this.store.get();

      if (!session) {
        this.redirect(302, "/");
      }

      return searchItems({
        searchForm: {
          q: `owner:${session.username} type:"Web Map"`,
          num: 100
        },
        authentication: new UserSession(session)
      })
        .catch(error => {
          return retryWithNewSession(error, this.fetch);
        })
        .then(response => {
          return {
            webmaps: response.results
          };
        })

        .catch(error => {
          console.error(error);
        });
    }
  };
</script>
